<!DOCTYPE html>
<html>
<head>
	<title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<script src="/js/bootstrap.bundle.min.js"></script>

<div id="root"></div>

<script crossorigin src="https://unpkg.com/react@17/umd/react.development.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<script type="text/babel">
  class NavBar extends React.Component{
    constructor(props){
      super(props)
    }

    render(){
      return (
          <nav className="navbar navbar-dark bg-dark">
           <div className="container-fluid">
              <a href="/customer/catalogue">Catalogo</a>
            <a href="/customer/purchases">Tus transacciones</a>
            <a href="/customer/account-settings">Configuracion de la cuenta</a>
            <a href="/customer/logout">Salir</a>
          </div>
         </nav>
      )
    }
  }
  //In the mean time, I render the items as individuals paragraph in the column, but, I will use a modal
  (async function test(){
    class Table extends React.Component{
      constructor(props){
        super(props)
        this.state={
          itemsModal: []
        }
        this.changeModalState=this.changeModalState.bind(this)
      }

      changeModalState(items){
        this.setState({
          itemsModal: items
        })
      }

      render(){
        return (
         <div>

          <table className="table">
            <thead>
              <tr>
                <th>Productos</th>
                <th>Precio total</th>
                <th>Metodo de pago</th>
                <th>Numero de referencia de la transaccion</th>
                <th>Estado de la transaccion</th>
                <th>Pedido entregado</th>
              </tr>
            </thead>
            <tbody>
              {this.props.purchases.map(purchase=>{
                  return <tr key={purchase.referenceTransactionNumber}>
                            <td>
                              <button type="button" className="btn btn-success" data-bs-toggle="modal" data-bs-target="#products" onClick={()=>this.changeModalState(purchase.items)}>Ver productos</button>
                           </td>
                           <td>{purchase.totalPrice}</td><td>{purchase.paymentMethod}</td>
                           <td>{purchase.referenceTransactionNumber}</td>
                           <td>{purchase.verificationStatus}</td>
                           <td>{purchase.deliveryStatus? 'Si' : 'No'}</td>
                         </tr>
              })}
            </tbody>
          </table>



          <div className="modal fade" id="products" tabIndex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div className="modal-dialog">
            <div className="modal-content">
            <div className="modal-header">
            <h5 className="modal-title" id="exampleModalLabel">Productos que compro el cliente</h5>
            <button type="button" className="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div className="modal-body">
            <table className="table">
              <thead>
                <tr>
                  <th>Producto</th><th>Cantidad</th><th>Precio</th>
                </tr>
              </thead>
              <tbody>
                {this.state.itemsModal.map(item=>{
                  return <tr key={item.name}>
                           <td>{item.name}</td><td>{item.amount}</td><td>{item.price}</td>
                         </tr>
                })}
              </tbody>
            </table>
          </div>
          <div className="modal-footer">
            <button type="button" className="btn btn-danger" data-bs-dismiss="modal">Cerrar</button>
          </div>
          </div>
          </div>
          </div>


        </div>
        )
      }
    }

    class transactions{
      async getTransactions(){
        let request=await fetch(`/customer/purchases/data`, {method: 'GET', headers: {'Content-Type': 'application/json'}})
        let response=await request.json()
        if (response.message==='Sucessfull operation'){
          return response.result
        } else{
          alert('Ha ocurrido un error al recuperar sus transacciones. Intentelo de nuevo')
          return []
        }
      }
    }
    let transactionsObject=new transactions()
    const navBar=<NavBar />
    const purchasesTable=<Table purchases={await transactionsObject.getTransactions()} />
    ReactDOM.render(
      <div>
      {navBar}
      {purchasesTable}
      </div>,
      document.getElementById('root')
    )
  })()
</script>
</body>
</html>